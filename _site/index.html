<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Lijiahao8898 &middot; F2E
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/aboutme.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

</head>


<body class="theme-base-08 layout-reverse">

<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>make progress every day</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">主页</a>

    

    

    

      

        

      

    

      

        

      

    

      

        

          <a class="sidebar-nav-item" href="/about">关于</a>

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

      

        

      

    

    <!-- 类目 -->

    

    <a class="sidebar-nav-item category"><span class="category-title">study</span><span class="category-number">&nbsp;（3）</span></a>

      

      <a class="sidebar-nav-item  sidebar-study" href="/2014/01/02/introducing-lanyon" style="display: none">&nbsp;&nbsp;&nbsp;Introducing Lanyon&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2014 - 01 - 02</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-study" href="/2014/01/01/example-content" style="display: none">&nbsp;&nbsp;&nbsp;Example content&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2014 - 01 - 01</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-study" href="/2013/12/31/whats-jekyll" style="display: none">&nbsp;&nbsp;&nbsp;What's Jekyll?&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2013 - 12 - 31</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">打包工具</span><span class="category-number">&nbsp;（4）</span></a>

      

      <a class="sidebar-nav-item  sidebar-打包工具" href="/2017/04/24/tool-fis3" style="display: none">&nbsp;&nbsp;&nbsp;tool - fis3&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 04 - 24</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-打包工具" href="/2017/02/21/tool-gulp" style="display: none">&nbsp;&nbsp;&nbsp;tool - gulp&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 02 - 21</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-打包工具" href="/2016/08/11/tool-webpack" style="display: none">&nbsp;&nbsp;&nbsp;tool - webpack&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 08 - 11</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-打包工具" href="/2016/06/29/tool-grunt" style="display: none">&nbsp;&nbsp;&nbsp;tool - grunt&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 06 - 29</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">javascript</span><span class="category-number">&nbsp;（5）</span></a>

      

      <a class="sidebar-nav-item  sidebar-javascript" href="/2017/08/18/javascript-fanxiang" style="display: none">&nbsp;&nbsp;&nbsp;javascript - !~&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 18</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-javascript" href="/2017/05/02/javascript-object" style="display: none">&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 05 - 02</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-javascript" href="/2016/10/31/javascript-object" style="display: none">&nbsp;&nbsp;&nbsp;javascript - 对象&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 10 - 31</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-javascript" href="/2016/08/26/javascript-this" style="display: none">&nbsp;&nbsp;&nbsp;javascript - this&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 08 - 26</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-javascript" href="/2016/08/19/javascript-es6" style="display: none">&nbsp;&nbsp;&nbsp;ES6&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 08 - 19</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">git</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-git" href="/2016/08/22/git" style="display: none">&nbsp;&nbsp;&nbsp;git&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 08 - 22</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">other</span><span class="category-number">&nbsp;（3）</span></a>

      

      <a class="sidebar-nav-item  sidebar-other" href="/2016/11/19/study-knowledge" style="display: none">&nbsp;&nbsp;&nbsp;F2E整理&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 11 - 19</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-other" href="/2016/10/26/github-and-jekyll" style="display: none">&nbsp;&nbsp;&nbsp;github & jekyll 编写自己的小网站&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 10 - 26</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-other" href="/2016/08/30/console" style="display: none">&nbsp;&nbsp;&nbsp;非常实用的console&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 08 - 30</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">node</span><span class="category-number">&nbsp;（2）</span></a>

      

      <a class="sidebar-nav-item  sidebar-node" href="/2016/11/11/node-js-css-min" style="display: none">&nbsp;&nbsp;&nbsp;node单个文件压缩-js&css&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 11 - 11</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-node" href="/2016/09/12/node" style="display: none">&nbsp;&nbsp;&nbsp;node&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2016 - 09 - 12</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">QandA</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-QandA" href="/2017/01/24/question" style="display: none">&nbsp;&nbsp;&nbsp;问题整理&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 01 - 24</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">vue</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-vue" href="/2017/05/14/vue" style="display: none">&nbsp;&nbsp;&nbsp;vue&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 05 - 14</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">style</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-style" href="/2017/05/17/css" style="display: none">&nbsp;&nbsp;&nbsp;css&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 05 - 17</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">angular</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-angular" href="/2017/05/24/angular1" style="display: none">&nbsp;&nbsp;&nbsp;angular&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 05 - 24</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">wechat</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-wechat" href="/2017/06/26/wechat-xcx" style="display: none">&nbsp;&nbsp;&nbsp;wechat&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 06 - 26</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">react</span><span class="category-number">&nbsp;（4）</span></a>

      

      <a class="sidebar-nav-item  sidebar-react" href="/2017/08/28/react-router" style="display: none">&nbsp;&nbsp;&nbsp;初识react（三）- router&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 28</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-react" href="/2017/08/25/react-redux" style="display: none">&nbsp;&nbsp;&nbsp;初识react（二）- redux&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 25</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-react" href="/2017/08/23/react-jsj" style="display: none">&nbsp;&nbsp;&nbsp;react脚手架&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 23</p>-->
      </a>

      

      <a class="sidebar-nav-item  sidebar-react" href="/2017/08/22/react-first" style="display: none">&nbsp;&nbsp;&nbsp;初识react（一）- react&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 22</p>-->
      </a>

      

    

    <a class="sidebar-nav-item category"><span class="category-title">browser</span><span class="category-number">&nbsp;（1）</span></a>

      

      <a class="sidebar-nav-item  sidebar-browser" href="/2017/08/28/dns-prefetch" style="display: none">&nbsp;&nbsp;&nbsp;游览器性能提升 - dns-prefetch&nbsp;&nbsp;
        <!--<p class="date">&nbsp;&nbsp;&nbsp;2017 - 08 - 28</p>-->
      </a>

      

    

    <!--<a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>-->

    <!--<a class="sidebar-nav-item" href="">GitHub project</a>-->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


<!-- Wrap is the content to shift when toggling the sidebar. We wrap the
     content to avoid any CSS collisions with our real content. -->
<div class="wrap">

  <div class="masthead">

    <div class="container">

      <h3 class="masthead-title">

        <a href="/" title="Home">Lijiahao8898</a>

        <small>F2E - 人丑就要多读书</small>

      </h3>

    </div>

  </div>

  <div class="container content">

    <!--<div class="about-me">-->
    <!--<div class="my-info">-->
        <!--<div class="left">-->
            <!--&lt;!&ndash;<div><img src="./public/my.jpg"></div>&ndash;&gt;-->
        <!--</div>-->
        <!--<div class="right">-->
            <!--<dl>-->
                <!--<dd><label>name:</label><span>lijiahao</span></dd>-->
                <!--<dd><label>address:</label><span>cn</span></dd>-->
                <!--<dd><label>github:</label><span><a href="https://github.com/lijiahao8898" target="_blank">https://github.com/lijiahao8898</a></span></dd>-->
                <!--<dd><a href="#">more</a></dd>-->
            <!--</dl>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->

<div class="posts">
    
    <div class="post">
        <h1 class="post-title">
            <a href="/2017/08/28/react-router">
                初识react（三）- router
            </a>
        </h1>

        <span class="post-date">28 Aug 2017</span>

        <h2 id="what-is-react-router-">what is react-router ?</h2>

<p><code class="highlighter-rouge">react-router</code> 前端路由功能。</p>

<p>最大的特点是 <code class="highlighter-rouge">react-router</code> 不需要配置专门的路由配置文件，只需要像普通的组件一样，引入几个组件，就能够添加 <code class="highlighter-rouge">react</code> 的路由功能。</p>

<h3 id="react-router">使用react-router</h3>

<p><code class="highlighter-rouge">react-router</code> 的使用非常简单，它目前已经发行到了 v4 版本，而之前的3个版本在网络上也能找到非常多的应用。在这里我们仅拿最新的版本
作为示例。在 <code class="highlighter-rouge">react-router@4</code> 版本当中，专门为Web端提供了高度封装好的 <code class="highlighter-rouge">react-router-dom</code> 库，这下我们几乎不需要任何的配置就可
以直接使用前端路由功能了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/* 这里引入的3个方法全部都是封装好的 React 组件，使用方法和其他 React 组件几乎没有任何差别 */
const { HashRouter, Route, Redirect } = ReactRouterDOM;
</code></pre>
</div>

<h3 id="hashrouter">HashRouter</h3>

<p><code class="highlighter-rouge">HashRouter</code> 为我们的应用提供了 <code class="highlighter-rouge">hash</code> 形式（也就是带#的路由）路由的功能支持。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/* 在通常情况下，我们不需要为 HashRouter 进行任何设置，直接引入使用即可。 */
&lt;HashRouter&gt;
  &lt;App/&gt;
&lt;/HashRouter&gt;
</code></pre>
</div>

<p>主要到在 <code class="highlighter-rouge">react-router</code> 提供的所有类型的 <code class="highlighter-rouge">Router</code> 组件当中，第一级的子组件有且只能有一个。因此我们在使用的时候，通常在我们应用
组件的最外层包裹上一个 <code class="highlighter-rouge">&lt;div&gt;</code> 标签：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;HashRouter&gt;
  &lt;div&gt;
    ...
  &lt;/div&gt;
&lt;/HashRouter&gt;
</code></pre>
</div>

<p>这里为了方便在线演示，所以我们使用了 <code class="highlighter-rouge">HashRouter</code> 组件，在实际的开发当中，更经常使用的是 <code class="highlighter-rouge">BrowserRouter</code> 组件，它可以为我们提
供不带 # 的前端路由支持，更加友好。</p>

<h3 id="route">Route</h3>

<p>前端路由的主要功能就是通过判断不同的浏览器地址显示不同的内容，那么具体某个路由地址要怎么展示某个组件呢？</p>

<p>这就是 <code class="highlighter-rouge">Route</code> 组件为我们提供的功能：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;HashRouter&gt;
    &lt;div&gt;
      &lt;Route path='/:title?' component={App} /&gt;
    &lt;/div&gt;
&lt;/HashRouter&gt;
</code></pre>
</div>

<p>其中的 <code class="highlighter-rouge">path</code> 属性用来设置匹配的目标路由地址，路由地址可以是固定的字符串，例如 <code class="highlighter-rouge">home/about/user</code> 之类的，也可以像我们示例中一样
，以冒号开头将路由的地址作为参数，之后我们可以在组件当中获取到对应的路由参数（以?结尾则表示这一参数是可选的）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const Title = props =&gt; &lt;h1&gt;{props.title}&lt;/h1&gt;;

const App = ({ match }) =&gt; (
  &lt;Provider store={store}&gt;
    &lt;Counter title={match.params.title} /&gt;
  &lt;/Provider&gt;
);
</code></pre>
</div>

<p>这里的 <code class="highlighter-rouge">match.params.title</code> 也就是我们路由参数当中对应的值了。</p>

<h3 id="link">Link</h3>

<p>有了前端路由的内容，我们还需要相应的前端路由的导航。前端路由导航的主要功能是实现浏览器地址栏 URL 的切换，并触发Web应用展示对应的内容，
而不是像原生的 HTML 超链接试图向服务器发起对应 URL 的请求。</p>

<p><code class="highlighter-rouge">react-router</code> 同样为我们提供了现成的 <code class="highlighter-rouge">Link</code> 导航组件：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;HashRouter&gt;
    &lt;div&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;Link to='/react'&gt;react&lt;/Link&gt;&lt;/li&gt;
        &lt;li&gt;&lt;Link to='/redux'&gt;redux&lt;/Link&gt;&lt;/li&gt;
        &lt;li&gt;&lt;Link to='/react-router'&gt;react-router&lt;/Link&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;Route path='/:title?' component={App} /&gt;
    &lt;/div&gt;
&lt;/HashRouter&gt;
</code></pre>
</div>


    </div>
    
    <div class="post">
        <h1 class="post-title">
            <a href="/2017/08/28/dns-prefetch">
                游览器性能提升 - dns-prefetch
            </a>
        </h1>

        <span class="post-date">28 Aug 2017</span>

        <h2 id="what-is-dns-prefetch-">what is dns-prefetch ?</h2>

<p><code class="highlighter-rouge">DNS</code> 请求需要的带宽非常小，但是延迟却有点高，这点在手机网络上特别明显</p>

<p><code class="highlighter-rouge">dns-prefetch</code>, 是 <code class="highlighter-rouge">DNS</code> 预获取，也是网页前端的优化的一种技术。其范围包括文档的所有链接，无论是
图片的，<code class="highlighter-rouge">CSS</code> 的，还是 <code class="highlighter-rouge">JavaScript</code> 等其他用户能够点击的 <code class="highlighter-rouge">URL</code>。</p>

<p>一般在前端优化中与 <code class="highlighter-rouge">DNS</code> 有关的两点：</p>

<ol>
  <li>减少请求次数</li>
  <li>提前对 <code class="highlighter-rouge">DNS</code> 预获取。</li>
</ol>

<p><code class="highlighter-rouge">DNS</code> 作为互联网的基础协议，其解析速度很容易被网站优化人员SEO人员忽视，其典型的一次 <code class="highlighter-rouge">dns-prefetch</code>解析需要“20-120ms”,
减少 <code class="highlighter-rouge">DNS</code> 解析时间和次数是一个不错的优化方式。</p>

<p><code class="highlighter-rouge">dns-prefetch</code> ​作用简单说明就是当你浏览网页时，浏览器会加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页链接
无需 <code class="highlighter-rouge">DNS</code> 解析，减少浏览者等待时间，提高用户体验。</p>

<p>浏览器对网站第一次的域名 <code class="highlighter-rouge">DNS</code> 解析查找流程依次为：</p>

<p>浏览器缓存-系统缓存-路由器缓存-ISP DNS缓存-递归搜索</p>

<p><img src="../../../assets/2.jpeg" /></p>

<p><br /></p>

<h3 id="dns-prefetch">那么如何添加dns-prefetch？</h3>

<p>当然在浏览器支持方面 <code class="highlighter-rouge">google chrome</code>、 <code class="highlighter-rouge">firefox3.5</code> 浏览器 、<code class="highlighter-rouge">safari 5+</code>、<code class="highlighter-rouge">IE9</code>等。<code class="highlighter-rouge">dns-prefetch</code> 放入位置推荐在后面。具体代码为：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// X-DNS-Prefetch-Control 头控制着浏览器的 DNS 预读取功能
// content: on 启用 DNS预解析，off 关闭 DNS预解析
&lt;meta http-equiv="x-dns-prefetch-control" content="on" /&gt;

&lt;link rel="dns-prefetch" href="http://bdimg.share.baidu.com" /&gt;
</code></pre>
</div>

<h3 id="dns-">打开和关闭 DNS 预读取</h3>

<p>你可以通过在服务器端发送 <code class="highlighter-rouge">X-DNS-Prefetch-Control</code> 报头，或是在文档中使用值为 <code class="highlighter-rouge">http-equiv</code> 的 <code class="highlighter-rouge">&lt;meta&gt;</code>` 标签：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;meta http-equiv="x-dns-prefetch-control" content="off"&gt;
</code></pre>
</div>

<p>您可以通过将 <code class="highlighter-rouge">content</code> 的参数设置为“on”来改变设置。</p>

<h3 id="section">强制查询特定主机名</h3>

<p>你可以通过使用 <code class="highlighter-rouge">rel</code> 属性值为 <code class="highlighter-rouge">link type</code> 中的 <code class="highlighter-rouge">dns-prefetch</code> 的 <code class="highlighter-rouge">&lt;link&gt;</code> 标签来对特定域名进行预读取：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;link rel="dns-prefetch" href="http://www.spreadfirefox.com/"&gt;
</code></pre>
</div>

<p>而且，<code class="highlighter-rouge">&lt;link&gt;</code> 元素也可以使用不完整的 <code class="highlighter-rouge">URL</code> 的主机名来标记预解析，但这些主机名前必需要有双斜线：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;link rel="dns-prefetch" href="//www.spreadfirefox.com"&gt;
</code></pre>
</div>

<p>强制对域名进行预读取在有的情况下很有用, 比如, 在网站的主页上，强制在整个网站上频繁引用的域名的预解析，即使它们不在主页本身上使用。
即使主页的性能可能不受影响，这将提高整体站点性能。</p>

<p>需要注意，虽然 <code class="highlighter-rouge">dns-prefetch</code> 能够加快网页解析速度，但是也不能随便滥用，因为多页面重复 <code class="highlighter-rouge">DNS</code> 预解析会增加重复 <code class="highlighter-rouge">DNS</code> 查询的次数。</p>

<p>总结：在优化当中 <code class="highlighter-rouge">dns-prefetch</code> 对网页预获取，在提高大型网站浏览速度方面可以提高，不用让浏览者等待是一个不错的方法。</p>

    </div>
    
    <div class="post">
        <h1 class="post-title">
            <a href="/2017/08/25/react-redux">
                初识react（二）- redux
            </a>
        </h1>

        <span class="post-date">25 Aug 2017</span>

        <h2 id="what-is-redux-">what is redux ?</h2>

<p><code class="highlighter-rouge">react</code> 处理数据的方式主要有 <code class="highlighter-rouge">props</code> 和 <code class="highlighter-rouge">state</code> 两种。</p>

<p>其中的 <code class="highlighter-rouge">props</code> 必须是从父组件传递到子组件，如果嵌套层级很多，<code class="highlighter-rouge">props</code> 必须逐级从保存数据的组件层层
传递到使用 <code class="highlighter-rouge">props</code> 的组件当中。而 <code class="highlighter-rouge">state</code> 在使用的时候，必须通过调用 <code class="highlighter-rouge">this.setState()</code> 方法，
在改变 <code class="highlighter-rouge">state</code> 值的同时，触发 <code class="highlighter-rouge">React</code> 组件运行的生命周期，来触发界面的更新。 <code class="highlighter-rouge">this.setState()</code> 方
法可以传递数据、方法、回调函数。在同一次操作中，连续调用多次 <code class="highlighter-rouge">this.setState()</code> 方法也会造成许多难以预料的结果，
仅仅通过看代码你很难判断出最后值会变成什么。</p>

<p><code class="highlighter-rouge">redux</code> 的理念：把一个应用的所有状态数据存储在一个统一的地方集中管理。</p>

<p>如下图：</p>

<p><img src="../../../assets/1.png" /></p>

<h3 id="action">Action</h3>

<p><code class="highlighter-rouge">Action</code> 就是用统一的形式，描述所有改变应用状态数据的操作的方法。其实就是一个带有 <code class="highlighter-rouge">type</code> 属性的一
个 <code class="highlighter-rouge">JavaScript</code> 对象。</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="s1">'INCREMENT'</span><span class="p">,</span>
  <span class="nx">value</span><span class="err">:</span> <span class="mi">1</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="reducer">Reducer</h3>

<p><code class="highlighter-rouge">Reducer</code> 则是 <code class="highlighter-rouge">Redux</code> 的设计理念当中最核心的方法，它接受当前的状态数据以及触发的 <code class="highlighter-rouge">Action</code> 操作作为参数，根据内
部 <code class="highlighter-rouge">switch</code> 结构的逻辑判断，返回一个新的状态数据：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(previousState, action) =&gt; newState
</code></pre>
</div>

<p>例如在我们的计数器当中，可以抽象编写出这样一个 <code class="highlighter-rouge">Reducer</code> 方法：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function counter(state, action) {
    if (typeof state === 'undefined') {
        return 0
    }
    switch (action.type) {
      case 'INCREMENT':
        return state + action.value
      default:
        return state
    }
}
</code></pre>
</div>

<p>我们可以看到 <code class="highlighter-rouge">counter</code> 函数接受 <code class="highlighter-rouge">state</code> 和 <code class="highlighter-rouge">action</code> 两个参数，返回值则是经过一个 <code class="highlighter-rouge">switch</code> 结构判断的新的 <code class="highlighter-rouge">state</code>数
据。这样结构的函数也就是我们在使用 <code class="highlighter-rouge">Redux</code> 时编写的 <code class="highlighter-rouge">Reducer</code> 方法。</p>

<p>这是 <code class="highlighter-rouge">Redux</code> 理念当中最核心的一个部分，它决定了一个应用当中的状态数据在不同的 <code class="highlighter-rouge">Action</code> 被触发时具体会如何改变。</p>

<h3 id="store">Store</h3>

<p><code class="highlighter-rouge">Store</code> 则是 <code class="highlighter-rouge">Redux</code> 当中我们用来存储状态数据的地方，它提供了3个主要的方法：</p>

<ul>
  <li>
    <p>用来获取当前状态数据的 <code class="highlighter-rouge">getState()</code></p>
  </li>
  <li>
    <p>用来触发应用 <code class="highlighter-rouge">action</code> 动作的 <code class="highlighter-rouge">dispatch(action)</code></p>
  </li>
  <li>
    <p>用来订阅响应事件（<code class="highlighter-rouge">state</code>改变之后进行的操作）的 <code class="highlighter-rouge">subscribe(listener)</code></p>
  </li>
</ul>

<p>而在使用 <code class="highlighter-rouge">Redux</code> 时，我们可以通过它提供的 <code class="highlighter-rouge">createStore</code> 方法，直接从 <code class="highlighter-rouge">reducer</code> 函数生成对应的 <code class="highlighter-rouge">store</code> ：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const { createStore } = Redux;

const store = createStore(counter);
</code></pre>
</div>

<p>当然可以直接在 <code class="highlighter-rouge">react</code> 中使用 <code class="highlighter-rouge">redux</code> ：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
// 把之前 React 的渲染函数命名为 render
const render = () =&gt; {
  /* 传入 store.getState() 获取 Redux 当中存储的状态数据
   * 传入 store.dispatch() 方法来执行对应 action 修改状态数据
   */
  ReactDOM.render(&lt;Counter
              number={store.getState()}
              onIncrement={() =&gt; store.dispatch({
                          type: 'INCREMENT',
                          value: 1
                        })}
             /&gt;,
             document.getElementById('root'));
}

// 调用一次 render 方法进行初次渲染
render()

// 使用 store.subscribe 方法订阅 render 这样每次 store.dispatch 方法触发时就会自动调用 render
store.subscribe(render);
</code></pre>
</div>

<h3 id="react-redux">react-redux</h3>

<p>当然，每次 <code class="highlighter-rouge">Redux</code> 当中的状态数据改变时都强制执行 <code class="highlighter-rouge">ReactDOM</code> 的 <code class="highlighter-rouge">render</code> 方法并不是最优选择。事实上，
社区已经开发出了一个名为 <code class="highlighter-rouge">react-redux</code> 的库专门来辅助我们对 <code class="highlighter-rouge">React</code> 和 <code class="highlighter-rouge">Redux</code> 进行协同使用。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/* Provider 充当为整个 React 应用传入 Redux 当中 store 的容器组件
 * connect 用来为需要使用 store 的组件提供相应的状态数据或 dispatch 方法
 */

const { Provider, connect } = ReactRedux;

/* 我们通过 mapStateToProps 来将 Redux 当中的状态数据映射到 React 相应的 props 当中 */

const mapStateToProps = state =&gt; ({
  number: state
});

class Counter extends Component {
  constructor(props) {
    super(props);
  }

  handleClick() {

    // 在这里调用传入组件的 dispatch 方法

    this.props.dispatch({
      type: 'INCREMENT',
      value: 1
    });
  }

  render() {
    return (
      &lt;div&gt;
        &lt;Title /&gt;
        &lt;Number number={this.props.number} /&gt;
        &lt;Button onClick={() =&gt; this.handleClick()} /&gt;
      &lt;/div&gt;
    )
  }
}
/* 我们需要通过 connect 方法来包装一下 React 的 Counter 组件，使其获取到 Redux 的 store 当中的方法和数据 */
Counter = connect(mapStateToProps)(Counter);
</code></pre>
</div>

<h3 id="section">参考文档</h3>

<ul>
  <li><a href="http://cn.redux.js.org//index.html">redux中文文档</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/28241673">知乎专栏https://zhuanlan.zhihu.com/p/28241673</a></li>
</ul>

    </div>
    
</div>


<!-- 翻页部分 -->
<div class="pagination">

    

        
                <span class="pagination-item newer"> < </span>
            

        
            
                <span class="active pagination-item">1</span>
            
        
            
                <a class="pagination-item" href="/page2">2</a>
            
        
            
                <a class="pagination-item" href="/page3">3</a>
            
        
            
                <a class="pagination-item" href="/page4">4</a>
            
        
            
                <a class="pagination-item" href="/page5">5</a>
            
        
            
                <a class="pagination-item" href="/page6">6</a>
            
        
            
                <a class="pagination-item" href="/page7">7</a>
            
        
            
                <a class="pagination-item" href="/page8">8</a>
            
        
            
                <a class="pagination-item" href="/page9">9</a>
            
        
            
                <a class="pagination-item" href="/page10">10</a>
            
        

        
            <a class="pagination-item older" href="/page2"> > </a>
        

    
</div>



  </div>

</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>
<script type="text/javascript" src="../../../jquery.min.js"></script>

<script>
  (function (document) {
    var toggle = document.querySelector('.sidebar-toggle');
    var sidebar = document.querySelector('#sidebar');
    var checkbox = document.querySelector('#sidebar-checkbox');

    document.addEventListener('click', function (e) {
      var target = e.target;

      if (!checkbox.checked || sidebar.contains(target) || (target === checkbox || target === toggle)) return;
      checkbox.checked = false;
    }, false);
  })(document);
</script>

<script>
  (function () {
    $('.category').click(function () {
      var categoryTitle = $.trim($(this).find('.category-title').text());
      var className = '.sidebar-' + categoryTitle;
//      $(className).show();
      $(className).toggleClass('is-show');
    })
  })();
</script>
</body>
</html>
